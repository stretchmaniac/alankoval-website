function animate(){animationVars=[];var a=$(".variable-list-item");$(".animate-error-area").empty();var b=!1;a.each(function(){var a=$(this).find(".var-name-input").val(),c=parseFloat($(this).find(".var-lower-bound-input").val()),d=parseFloat($(this).find(".var-upper-bound-input").val());(!isFinite(c)||!isFinite(d)||isNaN(c)||isNaN(d)||0===a.trim().length||c>d)&&($(".animate-error-area").append("<div style='color:red'>Error with variable <i>"+a+"</i>.</div>"),b=!0),animationVars.push({name:a,low:c,high:d})});var c=parseFloat($("#animation-frame-input").val());if((0===$("#animation-frame-input").val().length.trim||isNaN(c))&&($(".animate-error-area").append("<div style='color:red'>Please enter frame count.</div>"),b=!0),!b){animationImgs=[],domain.animating=!0,$("#animate-start-button").prop("disabled",!0);for(var d=0;d<animationVars.length;d++){var e=animationVars[d];e.value=e.low,e.step=(e.high-e.low)/c*1.000000000001}$("#animation-progress-bar").show(),$("#animation-progress-bar").prop("max",c);var f=1;$("#animation-progress-bar").prop("value",f),graph(function(){f++,$("#animation-progress-bar").prop("value",f);for(var a=!1,b=0;b<animationVars.length;b++){var c=animationVars[b];c.value+=c.step,c.value>=c.high&&(a=!0)}var d=document.getElementById("canvas").toDataURL("image/png");if(animationImgs.push(d),a===!1)try{graph(arguments.callee)}catch(b){displayCanvasError(),console.log(b.stack),a=!0,$("#animate-popup").addClass("hidden"),$("#animate-start-button").prop("disabled",!1),domain.animating=!1}else onAnimationFinish()})}}function onAnimationFinish(){$("#animate-start-button").prop("disabled",!1),$("#animation-progress-bar").hide(),$("#animate-popup").addClass("hidden"),$("#animate-content").unbind("click",document),domain.animating=!1;for(var a=0;a<animationImgs.length;a++)!function(){var b=a,c=new Image;c.onload=function(){animationImgs[b]=c,b===animationImgs.length-1&&($("#export-gif-progress-bar").hide(),$("#animation-result-export-button").show(),startAnimationPlayback())},c.src=animationImgs[a]}()}function startAnimationPlayback(){$("#animation-result-popup").show();var a=document.getElementById("canvas"),b=document.getElementById("animation-canvas");b.height=a.clientHeight,b.width=a.clientWidth;var c="loop",d=1,e=50;c=$("input[type=radio][name=play-style]:checked").prop("value"),$("input[type=radio][name=play-style]").change(function(){c=this.value}),$("#animation-result-frame-time-input").on("input",function(){e=parseFloat(5*(101-this.value))}),$("#animation-result-exit-button").click(function(){$("#animation-result-popup").hide(),domain.stopAnimating=!0,animationImgs=[]});for(var g=[],h=0;h<animationImgs.length;h++)g.push(animationImgs[h].src);var i=null,j=1;$("#animation-result-export-button").click(function(){$("#animation-result-export-button").hide(),$("#export-gif-progress-bar").show(),j=1,i=new CCapture({verbose:!0,framerate:1e3/e,quality:1,name:"Graph",format:"webm",workersPath:"",progress:function(){var a;a="loop"===c?j/g.length:j/(2*g.length-1),j++,$("#export-gif-progress-bar").prop("value",a),1===a&&($("#animation-result-export-button").show(),$("#export-gif-progress-bar").hide())}}),i.start()});var k=b.getContext("2d"),l=0;domain.stopAnimating=!1;var m=!1,n=setTimeout(function(){if(domain.stopAnimating===!1){var a=!1;m===!1&&null!==i&&(l=0,m=!0,a=!0),null===i||0!==l||a||(i.stop(),i.save(),i=null,m=!1);var f=animationImgs[l];"loop"===c?(l++,l===animationImgs.length&&(l=0)):"reverse"===c&&(l+=d,l!==-1&&l!==animationImgs.length||(d*=-1,l+=d)),k.drawImage(f,0,0),null!==i&&i.capture(b)}domain.stopAnimating===!0?clearTimeout(n):setTimeout(arguments.callee,e)},e)}function removeVariable(a){var b=$(a).parent();b.remove()}function randomGraph(){MQ=MathQuill.getInterface(2);var b,a=Math.random();if(cartesian=!1,cylindrical=!1,spherical=!1,a<.33){b=cartGallery[Math.floor(Math.random()*cartGallery.length)],cartesian=!0;var c=MQ.MathField(document.getElementById("x-input"));c.write(b[0]);var d=MQ.MathField(document.getElementById("y-input"));d.write(b[1]);var e=MQ.MathField(document.getElementById("z-input"));e.write(b[2]),$("#cartesian-button").click()}else if(a<.66){b=cylinFuncGallery[Math.floor(Math.random()*cylinFuncGallery.length)],cylindrical=!0;var f=MQ.MathField(document.getElementById("rho-input"));f.write(b[0]);var g=MQ.MathField(document.getElementById("phi-input"));g.write(b[1]);var h=MQ.MathField(document.getElementById("height-input"));h.write(b[2]),$("#cylindrical-button").click()}else{b=sphereFuncGallery[Math.floor(Math.random()*sphereFuncGallery.length)],spherical=!0;var i=MQ.MathField(document.getElementById("r-input"));i.write(b[0]);var j=MQ.MathField(document.getElementById("theta-input"));j.write(b[1]);var k=MQ.MathField(document.getElementById("sphi-input"));k.write(b[2]),$("#spherical-button").click()}}function getRealDomainCenter(){var a;return a=domain.panCenter?{x:domain.panCenter.x-(-domain.center.x+domain.panCenter.x)/domain.x.spread,y:domain.panCenter.y-(-domain.center.y+domain.panCenter.y)/domain.y.spread,z:domain.panCenter.z-(-domain.center.z+domain.panCenter.z)/domain.z.spread}:domain.center}function getRealDomainWidth(){return{x:(domain.x.max-domain.x.min)/domain.x.spread,y:(domain.y.max-domain.y.min)/domain.y.spread,z:(domain.z.max-domain.z.min)/domain.z.spread}}function changeDomainInputs(){MQ=MathQuill.getInterface(2);var a=getRealDomainCenter(),b=getRealDomainWidth();MQ($("#x-range-min-input")[0]).latex(a.x-b.x/2),MQ($("#x-range-max-input")[0]).latex(a.x+b.x/2),MQ($("#y-range-min-input")[0]).latex(a.y-b.y/2),MQ($("#y-range-max-input")[0]).latex(a.y+b.y/2),MQ($("#z-range-min-input")[0]).latex(a.z-b.z/2),MQ($("#z-range-max-input")[0]).latex(a.z+b.z/2),MQ($("#r-range-min-input")[0]).latex(domain.r.min),MQ($("#r-range-max-input")[0]).latex(domain.r.max),MQ($("#rho-range-min-input")[0]).latex(domain.rho.min),MQ($("#rho-range-max-input")[0]).latex(domain.rho.max),MQ($("#height-range-min-input")[0]).latex(domain.height.min),MQ($("#height-range-max-input")[0]).latex(domain.height.max)}function setUpDownload(){var a=document.getElementById("image-type-selector"),b=a.options[a.selectedIndex].value,c=document.getElementById("canvas"),d=c.toDataURL("image/"+b);d=d.replace(/^data:image\/[^;]*/,"data:application/octet-stream"),d=d.replace(/^data:application\/octet-stream/,"data:application/octet-stream;headers=Content-Disposition%3A%20attachment%3B%20filename=Graph."+b),document.getElementById("save-href").href=d,document.getElementById("save-href").download="Graph."+b}function isParametric(){var a=$("#x-input").text(),b=$("#y-input").text(),c=$("#z-input").text();return a.indexOf("u")!==-1||a.indexOf("v")!==-1||b.indexOf("u")!==-1||b.indexOf("v")!==-1||c.indexOf("u")!==-1||c.indexOf("v")!==-1}function isCylindricalParametric(){var a=$("#rho-input").text(),b=$("#phi-input").text(),c=$("#height-input").text();return a.indexOf("u")!==-1||a.indexOf("v")!==-1||b.indexOf("u")!==-1||b.indexOf("v")!==-1||c.indexOf("u")!==-1||c.indexOf("v")!==-1}function isSphericalParametric(){var a=$("#r-input").text(),b=$("#theta-input").text(),c=$("#sphi-input").text();return a.indexOf("u")!==-1||a.indexOf("v")!==-1||b.indexOf("u")!==-1||b.indexOf("v")!==-1||c.indexOf("u")!==-1||c.indexOf("v")!==-1}function evalDomain(a){MQ=MathQuill.getInterface(2);for(var b=parseLatex(MQ.MathField(a).latex(),animationVars),c={},d=0;d<animationVars.length;d++)c[animationVars[d].name]=animationVars[d].value;return math.eval(b,c)}function graph(a){if(domain.stopAnimating=!0,MQ=MathQuill.getInterface(2),a||(a=function(){}),!skipDomain){for(var b=["x","y","z","u","v","rho","phi","height","r","theta","sphi"],c=0;c<b.length;c++){var d=b[c];domain[d].min=evalDomain($("#"+d+"-range-min-input")[0]),domain[d].max=evalDomain($("#"+d+"-range-max-input")[0])}if(cylindrical&&(domain.x.max=Math.max(Math.abs(domain.rho.max),Math.abs(domain.rho.min)),domain.x.min=-Math.max(Math.abs(domain.rho.max),Math.abs(domain.rho.min)),domain.y.max=domain.x.max,domain.y.min=domain.x.min,domain.z.min=domain.height.min,domain.z.max=domain.height.max),spherical){var e=Math.max(Math.abs(domain.r.max),Math.abs(domain.r.min));domain.x.min=-e,domain.x.max=e,domain.y.min=-e,domain.y.max=e,domain.z.min=-e,domain.z.max=e}var f=domain.x.max-domain.x.min,g=domain.y.max-domain.y.min,h=domain.z.max-domain.z.min,i=Math.max(f,g,h),j=i/f,k=i/g,l=i/h;domain.x.spread=j,domain.y.spread=k,domain.z.spread=l;var m={x:j,y:k,z:l},n=(domain.x.min+domain.x.max)/2,o=(domain.y.min+domain.y.max)/2,p=(domain.z.min+domain.z.max)/2;domain.center={x:n,y:o,z:p},domain.x.max=n+j*f/2,domain.x.min=n-j*f/2,domain.y.max=o+k*g/2,domain.y.min=o-k*g/2,domain.z.max=p+l*h/2,domain.z.min=p-l*h/2}m={x:domain.x.spread,y:domain.y.spread,z:domain.z.spread},domain.center=getRealDomainCenter(),domain.showAxes=$("#axes-checkbox").prop("checked"),domain.coloring=$("#color-checkbox").prop("checked"),points=[],pointQuats=[],axes=[[{w:0,x:1,y:0,z:0},{w:0,x:-1,y:0,z:0},{w:0,x:1,y:0,z:0},{w:0,x:-1,y:0,z:0}],[{w:0,x:0,y:1,z:0},{w:0,x:0,y:-1,z:0},{w:0,x:0,y:1,z:0},{w:0,x:0,y:-1,z:0}],[{w:0,x:0,y:0,z:1},{w:0,x:0,y:0,z:-1},{w:0,x:0,y:0,z:1},{w:0,x:0,y:0,z:-1}]];var q=parseInt($("#density-input").text(),10);if(domain.density=q,syncAxes(),domain.pointsOnly===!0){pointQuats=[],points=[],domain.coloring=!0;for(var r=$("#plot-table-body"),s=r.children("tr"),t=0;t<s.length;t++){for(var u=$(s[t]).children("td"),v=!0,w=0;w<u.length;w++)0===u[w].textContent.trim().length&&(v=!1);if(3===u.length&&v){var A,x=u[0].textContent,y=u[1].textContent,z=u[2].textContent;cylindrical&&(A=cylindricalToCartesian(x,y,z),x=A.x,y=A.y,z=A.z),spherical&&(A=sphericalToCartesian(x,y,z),x=A.x,y=A.y,z=A.z),x=spreadCoord(x,domain.x.min,domain.x.max,domain.x.spread),y=spreadCoord(y,domain.y.min,domain.y.max,domain.y.spread),z=spreadCoord(z,domain.z.min,domain.z.max,domain.z.spread);for(var B=(domain.x.max-domain.x.min)*domain.pointWidthRatio,C=(domain.y.max-domain.y.min)*domain.pointWidthRatio,D=(domain.z.max-domain.z.min)*domain.pointWidthRatio,E={x:x+B,y:y,z:z},F=pointToQuat(E),G={x:x,y:y+C,z:z},H=pointToQuat(G),I={x:x-B,y:y,z:z},J=pointToQuat(I),K={x:x,y:y-C,z:z},L=pointToQuat(K),M={x:x,y:y,z:z+D},N=pointToQuat(M),O={x:x,y:y,z:z-D},P=pointToQuat(O),Q={x:x,y:y,z:z+D},R=pointToQuat(Q),S={x:x,y:y,z:z-D},T=pointToQuat(S),U=[E,G,I,K,M,O,Q,S],V=[F,H,J,L,N,P,R,T],W=0;W<U.length;W++)rotate(U[W],totalQuat),rotate(V[W],totalQuat);E.polygon={pts:[E,G,M]},G.polygon={pts:[G,I,M]},I.polygon={pts:[I,K,O]},K.polygon={pts:[K,E,O]},M.polygon={pts:[M,K,I]},O.polygon={pts:[O,E,G]},Q.polygon={pts:[Q,K,E]},S.polygon={pts:[S,G,I]};for(var X=0;X<U.length;X++)points.push(U[X]);for(F.polygon={pts:[F,H,N]},H.polygon={pts:[H,J,N]},J.polygon={pts:[J,L,P]},L.polygon={pts:[L,F,P]},N.polygon={pts:[N,L,J]},P.polygon={pts:[P,F,H]},R.polygon={pts:[R,L,F]},T.polygon={pts:[T,H,J]},X=0;X<V.length;X++)pointQuats.push(V[X])}}plotPoints()}else if(cartesian){var Y=MQ.MathField(document.getElementById("x-input")).latex();Y=parseLatex(Y,animationVars);var Z=MQ.MathField(document.getElementById("y-input")).latex();Z=parseLatex(Z,animationVars);var _=MQ.MathField(document.getElementById("z-input")).latex();_=parseLatex(_,animationVars);var aa=!1,ba=getRealDomainCenter(),ca=getRealDomainWidth();isParametric()?(aa=!0,$("#u-v-range-row").show(),graphParametricFunction(Y,Z,_,m,domain.shallowSketch,a)):Y.length>0?(Z="u",domain.u.min=ba.y-ca.y/2,domain.u.max=ba.y+ca.y/2,_="v",domain.v.min=ba.z-ca.z/2,domain.v.max=ba.z+ca.z/2,graphParametricFunction(Y,Z,_,m,domain.shallowSketch,a)):Z.length>0?(Y="u",domain.u.min=ba.x-ca.x/2,domain.u.max=ba.x+ca.x/2,_="v",domain.v.min=ba.z-ca.z/2,domain.v.max=ba.z+ca.z/2,graphParametricFunction(Y,Z,_,m,domain.shallowSketch,a)):_.length>0&&(Y="u",domain.u.min=ba.x-ca.x/2,domain.u.max=ba.x+ca.x/2,Z="v",domain.v.min=ba.y-ca.y/2,domain.v.max=ba.y+ca.y/2,graphParametricFunction(Y,Z,_,m,domain.shallowSketch,a)),aa===!1&&$("#u-v-range-row").hide(),$("#cartesian-button").click()}else if(cylindrical){var da=MQ.MathField(document.getElementById("rho-input")).latex();da=parseLatex(da,animationVars);var ea=MQ.MathField(document.getElementById("phi-input")).latex();ea=parseLatex(ea,animationVars);var fa=MQ.MathField(document.getElementById("height-input")).latex();if(fa=parseLatex(fa,animationVars),isCylindricalParametric()){for(var X=0;X<3;X++)da=da.replace(/phi/g,ea),da=da.replace(/\(z\)/g,"("+fa+")"),ea=ea.replace(/rho/g,da),ea=ea.replace(/\(z\)/g,"("+fa+")"),fa=fa.replace(/phi/g,ea),fa=fa.replace(/rho/g,da);Y="("+da+")cos("+ea+")",Z="("+da+")sin("+ea+")",_=fa,$("#u-range-row").show(),$("#v-range-row").show(),graphParametricFunction(Y,Z,_,m,domain.shallowSketch,a)}else da.length>0?(da=da.replace(/\(z\)/g,"(u)"),da=da.replace(/phi/g,"v"),_="u",Y="("+da+")cos(v)",Z="("+da+")sin(v)",domain.u.min=domain.height.min,domain.u.max=domain.height.max,domain.v.min=domain.phi.min,domain.v.max=domain.phi.max,graphParametricFunction(Y,Z,_,m,domain.shallowSketch,a)):ea.length>0?(ea=ea.replace(/\(z\)/g,"(u)"),ea=ea.replace(/rho/g,"v"),_="u",Y="v*cos("+ea+")",Z="v*sin("+ea+")",domain.u.min=domain.height.min,domain.u.max=domain.height.max,domain.v.min=domain.rho.min,domain.v.max=domain.rho.max,graphParametricFunction(Y,Z,_,m,domain.shallowSketch,a)):fa.length>0&&(_=fa,Y="cos(u)*v",Z="sin(u)*v",_=_.replace(/rho/g,"v"),_=_.replace(/phi/g,"u"),domain.u.min=domain.phi.min,domain.u.max=domain.phi.max,domain.v.min=domain.rho.min,domain.v.max=domain.rho.max,graphParametricFunction(Y,Z,_,m,domain.shallowSketch,a));$("#cylindrical-button").click()}else if(spherical){var ga=MQ.MathField(document.getElementById("r-input")).latex();ga=parseLatex(ga,animationVars);var ha=MQ.MathField(document.getElementById("theta-input")).latex();ha=parseLatex(ha,animationVars);var ia=MQ.MathField(document.getElementById("sphi-input")).latex();ia=parseLatex(ia,animationVars),isSphericalParametric()?($("#u-range-row").show(),$("#v-range-row").show()):($("#u-range-row").hide(),$("#v-range-row").hide(),ga.length>0?(ha="u",domain.u.min=domain.theta.min,domain.u.max=domain.theta.max,ia="v",domain.v.min=domain.sphi.min,domain.v.max=domain.sphi.max,ga=ga.replace(/theta/g,"u"),ga=ga.replace(/phi/g,"v")):ha.length>0?(ga="u",domain.u.min=domain.r.min,domain.u.max=domain.r.max,ia="v",domain.v.min=domain.sphi.min,domain.v.max=domain.sphi.max,ha=ha.replace(/\(r\)/g,"(u)"),ha=ha.replace(/phi/g,"v")):ia.length>0&&(ga="u",domain.u.min=domain.r.min,domain.u.max=domain.r.max,ha="v",domain.v.min=domain.theta.min,domain.v.max=domain.theta.max,ia=ia.replace(/\(r\)/g,"(u)"),ia=ia.replace(/theta/g,"v")));for(var ja=0;ja<3;ja++)ga=ga.replace("theta",ha),ga=ga.replace("phi",ia),ha=ha.replace("(r)","("+ga+")"),ha=ha.replace("phi",ia),ia=ia.replace("(r)","("+ga+")"),ia=ia.replace("theta",ha);Y="("+ga+")*sin("+ia+")*cos("+ha+")",Z="("+ga+")*sin("+ia+")*sin("+ha+")",_="("+ga+")*cos("+ia+")",graphParametricFunction(Y,Z,_,m,domain.shallowSketch,a),$("#spherical-button").click()}}function sphericalToCartesian(a,b,c){return{x:a*Math.sin(c)*Math.cos(b),y:a*Math.sin(c)*Math.sin(b),z:a*Math.cos(c)}}function cylindricalToCartesian(a,b,c){return{x:a*Math.cos(b),y:a*Math.sin(b),z:c}}function refreshMathJax(){MathJax.Hub.Queue(["Typeset",MathJax.Hub])}function deepScan(){domain.shallowSketch=!1;var a=domain.density;domain.density=400,$("#grap-button").click(),domain.shallowSketch=!0,domain.density=a}function graphParametricFunction(a,b,c,d,e,f){syncAxes(),pointQuats=[];var g=domain.density*domain.density,h=domain.u.max-domain.u.min,i=domain.v.max-domain.v.min,j=h/i;j=1;var k=Math.sqrt(g/j);k=Math.floor(k);var l=j*k;l=Math.floor(l);for(var m=h/(l-1),n=i/(k-1),o=0,p=0;p<2;p++)a=a.replace(/\(y\)/g,"("+b+")"),a=a.replace(/\(z\)/g,"("+c+")"),b=b.replace(/\(x\)/g,"("+a+")"),b=b.replace(/\(z\)/g,"("+c+")"),c=c.replace(/\(x\)/g,"("+a+")"),c=c.replace(/\(y\)/g,"("+b+")");var q=compile(a),r=compile(b),s=compile(c);intervalFunctionSupported=!0;try{q.eval({u:0,v:0}),r.eval({u:0,v:0}),s.eval({u:0,v:0})}catch(a){intervalFunctionSupported=!1}a=math.compile("x="+a),b=math.compile("y="+b),c=math.compile("z="+c);try{plot(a,b,c,0,0)}catch(a){return console.log("error caught!"+a.stack),displayCanvasError(),void(graphingError=!0)}graphingError=!1;var t=!1;domain.coloring&&(t=!0),domain.coloring=!1,plotPoints(),graphing===!1?graphing=!0:(clearInterval(intervalId),clearInterval(intervalId2),clearInterval(intervalId3),clearInterval(intervalId4),clearInterval(intervalId5));var u=[];intervalId=setInterval(function(){if(o<l){for(var g=0,h=0;h<handleablePoints/domain.density&&o<l;h++){g++;var i=domain.u.min+o*m;graphParametricRow(n,o,k,a,b,c,i,q,r,s,u),o++,domain.percentCalculated=o/(l-1)}onlyPlotNewPoints=!0,pointsToPlot=domain.density*g,plotPoints(),displayCanvasMessage("drawing... "+(100*domain.percentCalculated).toFixed(2)+"%"),onlyPlotNewPoints=!1}else{clearInterval(intervalId);for(var j=0;j<u.length;j++)points.push(u[j]);onlyPlotNewPoints=!1,cleanParametricEdges(a,b,c,function(){syncQuats(),domain.coloring=t,e&&plotPoints(d),graphing=!1,f&&f()})}},10)}function displayCanvasError(){var a=document.getElementById("canvas"),b=a.getContext("2d"),c=a.clientWidth,d=a.clientHeight;b.fillStyle="white",b.fillRect(0,0,c,d),b.textAlign="center",b.fillStyle="rgba(0,0,0,.3)",b.font="50px Arial",b.fillText("Whoops! There was an error :(",c/2,d/2,c)}function displayCanvasMessage(a){var b=document.getElementById("canvas"),c=b.getContext("2d");c.font="15px Arial",c.fillStyle="dark"==domain.backgroundColor?"#222222":"white",c.fillRect(0,b.height-25,b.width,25),c.fillStyle="dark"==domain.backgroundColor?"#dddddd":"black",c.fillText(a,155,b.height-12)}function nextID(){return ID++,ID}function graphParametricRow(a,b,c,d,e,f,g,h,i,j,k){for(var l=0;l<c;l++){var m=domain.v.min+l*a,n=plot(d,e,f,g,m),o=pointToQuat(n),p=!1;if(b>0?(n.left=points[points.length-c],n.left||(console.log(b),console.log("undefined point!"),console.log(animationVars),console.log(n),console.log(points)),o.left=pointQuats[pointQuats.length-c],n.left.right=n,o.left.right=o):(n.leftEnd=!0,o.leftEnd=!0),l>0?(n.above=points[points.length-1],o.above=pointQuats[pointQuats.length-1],n.above.below=n,o.above.below=o):(n.topEnd=!0,o.topEnd=!0),b>0&&intervalFunctionSupported){for(var q={u:[n.left.u,n.u],v:n.v},r=0;r<animationVars.length;r++)q[animationVars[r].name]=animationVars[r].value;var s=h.eval(q),t=i.eval(q),u=j.eval(q);if(u.hi===1/0||u.lo===-(1/0)||s.hi===1/0||s.lo===-(1/0)||t.hi===1/0||t.lo===-(1/0)){p=!0;var v=n.left,w=isolateAsymptoteU(n.left.u,n.u,n.v,h,i,j,5),x=plot(d,e,f,w[1],n.v);x.z=null;var y=plot(d,e,f,w[0],n.v);y.z=null,insertH(x,v,n),insertH(y,v,v.right),k.push(x),k.push(y)}}if(l>0&&intervalFunctionSupported){for(var q={u:n.u,v:[n.above.v,n.v]},r=0;r<animationVars.length;r++)q[animationVars[r].name]=animationVars[r].value;var s=h.eval(q),t=i.eval(q),u=j.eval(q);if(u.hi===1/0||u.lo===-(1/0)||s.hi===1/0||s.lo===-(1/0)||t.hi===1/0||t.lo===-(1/0)){p=!0;var z=n.above,A=isolateAsymptoteV(n.above.v,n.v,n.u,h,i,j,5);x=plot(d,e,f,n.u,A[1]),x.z=null;var B=plot(d,e,f,n.u,A[0]);B.z=null,insertV(x,z,n),insertV(B,z,z.below),k.push(x),k.push(B)}}if(b>0&&l>0&&isNonReal(n)===!1&&isNonReal(n.left)===!1&&isNonReal(n.above)===!1&&isNonReal(n.left.above)===!1){var C=n,D=n.left,E=n.left.above,F=n.above,G={};G.pts=[C,D,E,F],p||(C.polygon=G),D.polygon=G,E.polygon=G,F.polygon=G}rotate(o,totalQuat),pointQuats.push(o),points.push(n)}}function averageValue(a){for(var b={x:0,y:0,z:0},c=0;c<a.length;c++){if(!a[c])return 99999999;b.x+=a[c].x,b.y+=a[c].y,b.z+=a[c].z}return{x:b.x/a.length,y:b.y/a.length,z:b.z/a.length}}function translateQuats(a,b){for(var c=0;c<pointQuats.length;c++)pointQuats[c].x+=a,pointQuats[c].y+=b}function getRealPart(a){return a.im?void 0:a}function setTotalQuat(){var a={w:0,x:1,y:0,z:0},b=unitQuat,c=cross(a,b);totalQuat.x=c.x,totalQuat.y=c.y,totalQuat.z=c.z,totalQuat.w=1+dot(a,b),quatNorm(totalQuat),rotate(a,totalQuat)}function dot(a,b){return a.x*b.x+a.y*b.y+a.z*b.z}function cross(a,b){return{x:a.y*b.z-a.z*b.y,y:a.z*b.x-a.x*b.z,z:a.x*b.y-a.y*b.x}}function solveSystem(a){var b=[[a[0][0],a[0][1],a[0][2],a[0][3]],[a[1][0],a[1][1],a[1][2],a[1][3]],[a[2][0],a[2][1],a[2][2],a[2][3]],[a[3][0],a[3][1],a[3][2],a[3][3]]],c=[[0,a[0][1],a[0][2],a[0][3]],[0,a[1][1],a[1][2],a[1][3]],[0,a[2][1],a[2][2],a[2][3]],[0,a[3][1],a[3][2],a[3][3]]],d=[[a[0][0],0,a[0][2],a[0][3]],[a[1][0],0,a[1][2],a[1][3]],[a[2][0],0,a[2][2],a[2][3]],[a[3][0],0,a[3][2],a[3][3]]],e=[[a[0][0],a[0][1],0,a[0][3]],[a[1][0],a[1][1],0,a[1][3]],[a[2][0],a[2][1],0,a[2][3]],[a[3][0],a[3][1],0,a[3][3]]],f=[[a[0][0],a[0][1],a[0][2],0],[a[1][0],a[1][1],a[1][2],0],[a[2][0],a[2][1],a[2][2],0],[a[3][0],a[3][1],a[3][2],0]],g=det(b);return{w:det(c)/g,x:det(d)/g,y:det(e)/g,z:det(f)/g}}function det(a){var b=a.length;if(2===b)return a[0][0]*a[1][1]-a[1][0]*a[0][1];for(var c=0,d=0;d<b;d++){for(var e=[],f=0;f<b-1;f++){for(var g=[],h=0;h<b-1;h++)g.push(0);e.push(g)}for(var i=0;i<b;i++)for(var j=1;j<b;j++)i!==d&&(i<d?e[j-1][i]=a[j][i]:e[j-1][i-1]=a[j][i]);c+=a[0][d]*det(e)}return c}function copyPoint(a){return{x:a.x,y:a.y,z:a.z}}function cleanParametricEdges(a,b,c,d){var e=[],f=0,g=0;intervalId2=setInterval(function(){if(f<points.length)for(var h=0;h<handleablePoints/10&&f<points.length;h++){cleanNextPoint(a,b,c,f,e),f++;var i=f/points.length;i*=100,i=parseFloat(i.toFixed(2)),i>g+1&&(displayCanvasMessage("detecting edges... "+i+"%"),g=i)}else{clearInterval(intervalId2);var j=[];addEdgePoints(e,j,function(){removeNullPoints(function(){cleanPolygonEdges(j,function(){d()})})})}},10)}function addEdgePoints(a,b,c){var d=0;intervalId4=setInterval(function(){if(d<a.length){for(var e=0;e<handleablePoints&&d<a.length;e++)points.push(a[d]),a[d].edgePoint=!0,b.push(a[d]),a[d].used=!1,a[d].sourced=!1,d++;displayCanvasMessage("adding new edge points... "+(100*d/a.length).toFixed(2)+"%")}else clearInterval(intervalId4),c()},10)}function removeNullPoints(a){var b=points.length-1,c=[];intervalId5=setInterval(function(){if(b>=0){for(var d=0;d<5e3&&b>=0;d++){var e=points[b];isNonReal(e)||c.push(points[b]),b--}displayCanvasMessage("removing non-real points... "+(100*(points.length-b)/points.length).toFixed(2)+"%")}else points=c,clearInterval(intervalId5),a()},10)}function cleanNextPoint(a,b,c,d,e){for(var f=points[d],g=["left","above"],h=0;h<g.length;h++){var k,i=g[h],j=f[i];j&&isNonReal(j)&&!isNonReal(f)&&(k=findParametricEdge(f,j,a,b,c,cleanDensity),k.v===domain.v.min&&(k.topEnd=!0),k.u===domain.u.min&&(k.leftEnd=!0),"left"===i?e.push(insertH(k,j,f)):e.push(insertV(k,j,f)),k.cleaned=!0),f&&isNonReal(f)&&!isNonReal(j)&&(k=findParametricEdge(j,f,a,b,c,cleanDensity),"left"===i?e.push(insertH(k,j,f)):e.push(insertV(k,j,f)),k.cleaned=!0)}}function cleanPolygonEdges(a,b){var c=0,d=a[0];if(d){d.used=!0;var g,e=d,f=0;intervalId3=setInterval(function(){if(c<a.length)for(var h=0;h<handleablePoints/10&&c<a.length;h++){3===f&&g!==e&&(e.used=!1),g=d,g.sourced=!0;for(var i=null,j=1.5*(domain.u.max-domain.u.min)/domain.density,k=0;k<a.length;k++){var l=a[k];if(l.used===!1){var m=uvDist(g,l),n=xyzDist(g,l);n>Math.max(domain.z.max-domain.z.min,domain.x.max-domain.x.min,domain.y.max-domain.y.min)&&(m=j+1),m<j&&(j=m,i=l)}}if(null!==i){g.extra=i,i.extra2=g,i.used=!0,d=i,f++;for(var o=isNonReal(g.below)?g.above:isNonReal(g.above)?g.below:isNonReal(g.left)?g.right:g.left,p=isNonReal(i.below)?i.above:isNonReal(i.above)?i.below:isNonReal(i.left)?i.right:i.left,q=[o,g,i,p],r=p,s=0;r&&o&&r!==o&&s<4;){var t=r.u-o.u,u=r.v-o.v,v="right";t>0&&(v="left");var w="below";u>0&&(w="above");var x=r[v],y=r[w];isNonReal(y)===!1&&0!==u&&y!==i?(q.push(y),r=y):(q.push(x),r=x),s++}r&&o&&(i.polygon={},i.polygon.pts=q)}else{for(var z=0;z<a.length;z++)if(a[z].sourced===!1){d=a[z];break}d.used=!0,e=d,f=0}c++;var A=(100*c/a.length).toFixed(2);displayCanvasMessage("cleaning edges... "+A+"%")}else clearInterval(intervalId3),b()},10)}else b()}function plot(a,b,c,d,e){for(var f={u:d,v:e,x:null,y:null,z:null},g=0;g<animationVars.length;g++)f[animationVars[g].name]=animationVars[g].value;a.eval(f),b.eval(f),c.eval(f);var h={u:d,v:e,x:getRealPart(f.x),y:getRealPart(f.y),z:getRealPart(f.z)};return h.x=spreadCoord(h.x,domain.x.min,domain.x.max,domain.x.spread),h.y=spreadCoord(h.y,domain.y.min,domain.y.max,domain.y.spread),h.z=spreadCoord(h.z,domain.z.min,domain.z.max,domain.z.spread),h}function isolateAsymptoteU(a,b,c,d,e,f,g){if(0===g)return[a,b];for(var h=(b-a)/999999999,i=(a+b)/2-h,j=b,k=[i,b],l={v:c,u:k},m=0;m<animationVars.length;m++)l[animationVars[m].name]=animationVars[m].value;var n=d.eval(l),o=e.eval(l),p=f.eval(l);return n.hi!==1/0&&n.lo!==-(1/0)&&o.hi!==1/0&&o.lo!==-(1/0)&&p.hi!==1/0&&p.lo!==-(1/0)&&(i=a,j=(a+b)/2+h),isolateAsymptoteU(i,j,c,d,e,f,g-1)}function isolateAsymptoteV(a,b,c,d,e,f,g){if(0===g)return[a,b];for(var h=(b-a)/999999999,i=(a+b)/2-h,j=b,k=[i,b],l={v:k,u:c},m=0;m<animationVars.length;m++)l[animationVars[m].name]=animationVars[m].value;var n=d.eval(l),o=e.eval(l),p=f.eval(l);return n.hi!==1/0&&n.lo!==-(1/0)&&o.hi!==1/0&&o.lo!==-(1/0)&&p.hi!==1/0&&p.lo!==-(1/0)&&(i=a,j=(a+b)/2+h),isolateAsymptoteU(i,j,c,d,e,f,g-1)}function uvDist(a,b){return Math.sqrt(Math.pow(a.u-b.u,2)+Math.pow(a.v-b.v,2))}function xyzDist(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)+Math.pow(a.z-b.z,2))}function isNonReal(a){return void 0===a||!a||isNaN(a.x)||isNaN(a.y)||isNaN(a.z)||null===a.x||null===a.y||null===a.z}function findParametricEdge(a,b,c,d,e,f){if(0===f)return a;for(var g=(a.u+b.u)/2,h=(a.v+b.v)/2,i={u:g,v:h,x:null,y:null,z:null},j=0;j<animationVars.length;j++)i[animationVars[j].name]=animationVars[j].value;c.eval(i),d.eval(i),e.eval(i),c.eval(i),d.eval(i),e.eval(i);var k={x:getRealPart(i.x),y:getRealPart(i.y),z:getRealPart(i.z)};return makeFiniteIfInfinate(k),k.x=spreadCoord(k.x,domain.x.min,domain.x.max,domain.x.spread),k.y=spreadCoord(k.y,domain.y.min,domain.y.max,domain.y.spread),k.z=spreadCoord(k.z,domain.z.min,domain.z.max,domain.z.spread),k.u=g,k.v=h,isNonReal(k)?findParametricEdge(a,k,c,d,e,f-1):findParametricEdge(k,b,c,d,e,f-1)}function makeFiniteIfInfinate(a){a.x==Number.POSITIVE_INFINITY&&(a.x=2*domain.x.max),a.y==Number.POSITIVE_INFINITY&&(a.y=2*domain.y.max),a.z==Number.POSITIVE_INFINITY&&(a.z=2*domain.z.max),a.x==Number.NEGATIVE_INFINITY&&(a.x=2*domain.x.min),a.y==Number.NEGATIVE_INFINITY&&(a.y=2*domain.y.min),a.z==Number.NEGATIVE_INFINITY&&(a.z=2*domain.z.min)}function spreadCoord(a,b,c,d){var e=(b+c)/2,f=a-e;return f*d+e}function antiSpread(a,b,c,d){var e=(a-(c+b)/2)/d;return e+(c+b)/2}function between(a,b){return{x:(a.x+b.x)/2,y:(a.y+b.y)/2,z:(a.z+b.z)/2}}function syncAxes(){axisEdge(axes[0]),axisEdge(axes[1]),axisEdge(axes[2]);var a=(domain.x.max-domain.x.min)/50;axes[0][0].x=domain.x.max,axes[0][1].x=domain.x.min,axes[0][2].x=domain.x.max+a,axes[0][3].x=domain.x.min-a,axes[1][0].y=domain.y.max,axes[1][1].y=domain.y.min,axes[1][2].y=domain.y.max+a,axes[1][3].y=domain.y.min-a,axes[2][0].z=domain.z.max,axes[2][1].z=domain.z.min,axes[2][2].z=domain.z.max+a,axes[2][3].z=domain.z.min-a,axes[0].dashed=!1,axes[1].dashed=!1,axes[2].dashed=!1,(domain.x.min>0||domain.x.max<0)&&(axes[1].dashed=!0,axes[2].dashed=!0),(domain.y.min>0||domain.y.max<0)&&(axes[0].dashed=!0,axes[2].dashed=!0),(domain.z.min>0||domain.z.max<0)&&(axes[0].dashed=!0,axes[1].dashed=!0),domain.center||(domain.center={x:(domain.x.max+domain.x.min)/2,y:(domain.y.max+domain.y.min)/2,z:(domain.z.max+domain.z.min)/2}),rotatePoints(axes[0],totalQuat),rotatePoints(axes[1],totalQuat),rotatePoints(axes[2],totalQuat)}function axisEdge(a){for(var b={x:0,y:0,z:0},c=0;c<a.length;c++)a[c].x=domain.x.min>b.x?domain.x.min:domain.x.max<b.x?domain.x.max:b.x,a[c].y=domain.y.min>b.y?domain.y.min:domain.y.max<b.y?domain.y.max:b.y,a[c].z=domain.z.min>b.z?domain.z.min:domain.z.max<b.z?domain.z.max:b.z}function syncQuats(){var a,b;pointQuats=[];for(var c=0;c<points.length;c++)a=pointToQuat(points[c]),points[c].id=c,a.id=c,a.end=points[c].end,a.topEnd=points[c].topEnd,a.leftEnd=points[c].leftEnd,rotate(a,totalQuat),pointQuats.push(a);for(var d=0;d<points.length;d++)if(b=points[d],a=pointQuats[d],b.left&&(a.left=pointQuats[b.left.id]),b.right&&(a.right=pointQuats[b.right.id]),b.above&&(a.above=pointQuats[b.above.id]),b.below&&(a.below=pointQuats[b.below.id]),b.extra&&(a.extra=pointQuats[b.extra.id]),b.extra2&&(a.extra2=pointQuats[b.extra2.id]),b.polygon){for(var e=b.polygon.pts,f=[],g=0;g<e.length;g++)f[g]=pointQuats[e[g].id];a.polygon={},a.polygon.pts=f}}function pointToQuat(a){return{w:0,x:a.x,y:a.y,z:a.z}}function insertH(a,b,c){return a!==b&&a!==c&&(a.right=c,a.left=b,b.right=a,c.left=a,a.above=a,a.below=a),a}function insertV(a,b,c){return a!==b&&a!==c&&(a.above=b,a.below=c,b.below=a,c.above=a,a.right=a,a.left=a),a}function sortPolygonsByZ(a){a.sort(function(a,b){return a.averageVal.z>b.averageVal.z?-1:1})}function plotPoints(){var a=document.getElementById("canvas"),b=a.getContext("2d");if(graphingError===!0)return void displayCanvasError();b.fillStyle="dark"==domain.backgroundColor?"#222222":"#ffffff",onlyPlotNewPoints===!1&&b.fillRect(0,0,a.width,a.height);var c="dark"==domain.backgroundColor?"#aaaaaa":"#222222";b.strokeStyle=c,b.lineWidth=getLineWidth(),b.setLineDash([]);var d;if(domain.coloring){d=[];for(var e=0;e<pointQuats.length;e++)if(pointQuats[e].polygon){var f=pointQuats[e].polygon;f.averageVal=averageValue(f.pts),d.push(f)}sortPolygonsByZ(d)}var g=a.width,h=a.height,i=(g-h)/2;i<0&&(i=0),i+=translation.x;var j=translation.y,k=0;onlyPlotNewPoints===!0&&(k=pointQuats.length-pointsToPlot);var l;for(b.beginPath(),b.lineWidth=getLineWidth(),domain.coloring&&(b.strokeStyle=c),l=k;l<pointQuats.length&&domain.coloring===!1;l++){var m=pointQuats[l],n=m.above,o=m.left,p=m.right,q=m.below,r=m.extra,s=m.extra2,t=transform(m.x,m.y,m.z,a);if(o)var u=transform(o.x,o.y,o.z,a);if(n)var v=transform(n.x,n.y,n.z,a);if(p)var w=transform(p.x,p.y,p.z,a);if(q)var x=transform(q.x,q.y,q.z,a);if(r)var y=transform(r.x,r.y,r.z,a);if(s)var z=transform(s.x,s.y,s.z,a);o&&u&&t&&n&&v?(b.moveTo(v.x+i,v.y+j),b.lineTo(t.x+i,t.y+j),b.lineTo(u.x+i,u.y+j)):(w&&p&&m.topEnd&&t&&(b.moveTo(w.x+i,w.y+j),b.lineTo(t.x+i,t.y+j)),x&&q&&m.leftEnd&&t&&(b.moveTo(x.x+i,x.y+j),b.lineTo(t.x+i,t.y+j))),r&&y&&t?(b.moveTo(t.x+i,t.y+j),b.lineTo(y.x+i,y.y+j)):s&&z&&t&&(b.moveTo(t.x+i,t.y+j),b.lineTo(z.x+i,z.y+j))}if(domain.coloring===!1&&b.stroke(),domain.coloring){var A=(new Date).getTime(),B=domain.minHue/256,C=domain.maxHue/256,D=(B+C)/2;for(l=0;l<d.length;l++){var E=d[l];if(E.pts.length>2){var G,F=E.averageVal,H=domain.center;rotate(F,quatConj(totalQuat),H);var I;if(cartesian&&(G=F.z,I=(G-domain.z.min)/(domain.z.max-domain.z.min)-.5),spherical){var J=Math.sqrt(F.x*F.x+F.y*F.y+F.z*F.z);I=J/domain.r.max-.5}cylindrical&&(J=Math.sqrt(F.x*F.x+F.y*F.y),I=J/domain.rho.max-.5),I=2/(1+Math.pow(Math.E,-4*I))-1,J=B-D;for(var K=D+I*J,L=polyNormal(E.pts[0],E.pts[1],E.pts[2]),M=0,N=domain.lightDirections.length,O=0;O<N;O++){var P=Math.min(angleBetween(L,domain.lightDirections[O]),angleBetween(L,scalar(-1,domain.lightDirections[O])));M+=domain.directionalLighting?.65*Math.cos(P)/N+.35/N:.74/N}var Q=HSVtoRGB(K,.5,M,1);b.beginPath(),b.lineWidth=1,b.fillStyle="rgba("+Q.r+","+Q.g+","+Q.b+",1)",b.strokeStyle="rgba("+Q.r+","+Q.g+","+Q.b+",1)";var R=transform(E.pts[0].x,E.pts[0].y,E.pts[0].z,a);if(R){b.moveTo(R.x+i,R.y+j);for(var S=1;S<E.pts.length&&E.pts[S];S++){var T=transform(E.pts[S].x,E.pts[S].y,E.pts[S].z,a);T&&b.lineTo(T.x+i,T.y+j)}b.lineTo(R.x+i,R.y+j)}b.fill(),b.stroke(),domain.showMeshWhileColoring&&(b.strokeStyle="rgba(0,0,0,1)",b.lineWidth=getLineWidth(),b.stroke())}}var U=(new Date).getTime()-A;domain.coloringTime=U}if(domain.showAxes&&0==onlyPlotNewPoints){var V=transform(axes[0][0].x,axes[0][0].y,axes[0][0].z,a),W=transform(axes[1][0].x,axes[1][0].y,axes[1][0].z,a),X=transform(axes[2][0].x,axes[2][0].y,axes[2][0].z,a),Y=transform(axes[0][1].x,axes[0][1].y,axes[0][1].z,a),Z=transform(axes[1][1].x,axes[1][1].y,axes[1][1].z,a),$=transform(axes[2][1].x,axes[2][1].y,axes[2][1].z,a),_=transform(axes[0][2].x,axes[0][2].y,axes[0][2].z,a),aa=transform(axes[0][3].x,axes[0][3].y,axes[0][3].z,a),ba=transform(axes[1][2].x,axes[1][2].y,axes[1][2].z,a),ca=transform(axes[1][3].x,axes[1][3].y,axes[1][3].z,a),da=transform(axes[2][2].x,axes[2][2].y,axes[2][2].z,a),ea=transform(axes[2][3].x,axes[2][3].y,axes[2][3].z,a),fa="dark"==domain.backgroundColor?"rgba(255,255,255,.5)":"rgba(0,0,0,.5)";
b.strokeStyle=fa,b.lineWidth=.5,V&&Y&&(b.beginPath(),axes[0].dashed?b.setLineDash([10,10]):b.setLineDash([]),b.moveTo(Y.x+i,Y.y+j),b.lineTo(V.x+i,V.y+j),b.stroke()),W&&Z&&(b.beginPath(),axes[1].dashed?b.setLineDash([10,10]):b.setLineDash([]),b.moveTo(Z.x+i,Z.y+j),b.lineTo(W.x+i,W.y+j),b.stroke()),X&&$&&(b.beginPath(),axes[2].dashed?b.setLineDash([10,10]):b.setLineDash([]),b.moveTo($.x+i,$.y+j),b.lineTo(X.x+i,X.y+j),b.stroke()),b.font="15px Arial",b.fillStyle=fa,b.textAlign="center";var ga=getRealDomainCenter(),ha=getRealDomainWidth();_&&aa&&(b.fillText("x: "+(ga.x+ha.x/2),_.x+i,_.y+j),b.fillText("x: "+(ga.x-ha.x/2),aa.x+i,aa.y+j)),ba&&ca&&(b.fillText("y: "+(ga.y+ha.y/2),ba.x+i,ba.y+j),b.fillText("y: "+(ga.y-ha.y/2),ca.x+i,ca.y+j)),da&&ea&&(b.fillText("z: "+(ga.z+ha.z/2),da.x+i,da.y+j),b.fillText("z: "+(ga.z-ha.z/2),ea.x+i,ea.y+j))}}function copyPoly(a){var b={};b.pts=[];for(var c=0;c<a.pts.length;c++)b.pts.push({x:a.pts[c].x,y:a.pts[c].y,z:a.pts[c].z});return b}function getLineWidth(){var a=.3*math.sech(domain.density/300);return a<.002&&(a=.002),a}function rotatePoints(a,b){for(var c=0;c<a.length;c++)rotate(a[c],b)}function depthPercent(a){return(a-domain.z.min)/(domain.z.max-domain.z.min)}function rotate(a,b,c){var d=c?c:domain.center,e={w:0,x:a.x-d.x,y:a.y-d.y,z:a.z-d.z},f=quatMult(quatMult(b,e),quatConj(b));a.x=f.x+d.x,a.y=f.y+d.y,a.z=f.z+d.z}function quatMult(a,b){return{w:a.w*b.w-a.x*b.x-a.y*b.y-a.z*b.z,x:a.w*b.x+a.x*b.w+a.y*b.z-a.z*b.y,y:a.w*b.y+a.y*b.w-a.x*b.z+a.z*b.x,z:a.w*b.z+a.z*b.w+a.x*b.y-a.y*b.x}}function quatScalar(a,b){return{w:a.w*b,x:a.x*b,y:a.y*b,z:a.z*b}}function quatConj(a){return{w:a.w,x:-a.x,y:-a.y,z:-a.z}}function transform(a,b,c,d){var e=spreadCoord(domain.z.min,domain.z.min,domain.z.max,1.6),f=spreadCoord(domain.z.min,domain.z.min,domain.z.max,3),g={x:domain.center.x,y:domain.center.y,z:f},h=2;if(domain.perspective===!1&&(g.z*=9999999,h=1),a=h*(a-g.x)/(c-g.z)*(e-g.z)+g.x,b=h*(b-g.y)/(c-g.z)*(e-g.z)+g.y,c<e)return null;var i=Math.min(d.width,d.height),j=(a-domain.x.min)/(domain.x.max-domain.x.min)*i,k=(b-domain.y.min)/(domain.y.max-domain.y.min)*i;return{x:j,y:k}}function quatNorm(a){var b=Math.sqrt(a.w*a.w+a.x*a.x+a.y*a.y+a.z*a.z);return a.w/=b,a.x/=b,a.y/=b,a.z/=b,a}function polyNormal(a,b,c){var d=sub(b,a),e=sub(c,a),f={};return f.x=d.y*e.z-d.z*e.y,f.y=d.z*e.x-d.x*e.z,f.z=d.x*e.y-d.y*e.x,f}function angleBetween(a,b){var c=dot(a,b),d=Math.acos(c/(magnitude(a)*magnitude(b)));return d>Math.PI?2*Math.PI-d:d}function sub(a,b){return{x:a.x-b.x,y:a.y-b.y,z:a.z-b.z}}function scalar(a,b){return{x:b.x*a,y:b.y*a,z:b.z*a}}function magnitude(a){return Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z)}function HSVtoRGB(a,b,c,d){var e,f,g,h,i,j,k,l;switch(a&&void 0===b&&void 0===c&&(b=a.s,c=a.v,a=a.h),h=Math.floor(6*a),i=6*a-h,j=c*(1-b),k=c*(1-i*b),l=c*(1-(1-i)*b),h%6){case 0:e=c,f=l,g=j;break;case 1:e=k,f=c,g=j;break;case 2:e=j,f=c,g=l;break;case 3:e=j,f=k,g=c;break;case 4:e=l,f=j,g=c;break;case 5:e=c,f=j,g=k}return{r:Math.floor(255*e),g:Math.floor(255*f),b:Math.floor(255*g),a:d}}var domain={x:{min:-10,max:10,spread:1},y:{min:-10,max:10,spread:1},z:{min:-10,max:10,spread:1},u:{min:-10,max:10},v:{min:-10,max:10},rho:{min:0,max:10},phi:{min:0,max:2*Math.PI},height:{min:-10,max:10},r:{min:0,max:10},theta:{min:0,max:2*Math.PI},sphi:{min:-Math.PI/2,max:Math.PI/2},density:60,coloring:!0,showAxes:!0,shallowSketch:!0,percentCalculated:0,lightDirections:[{x:0,y:0,z:-1}],pointsOnly:!1,pointWidthRatio:.005,animating:!1,stopAnimating:!0,showMeshWhileColoring:!1,directionalLighting:!0,perspective:!0,backgroundColor:"dark",minHue:50,maxHue:170,fullscreen:!1},compile=require("interval-arithmetic-eval"),handleablePoints=5e3,xQuat=quatNorm({w:1,x:0,y:0,z:0}),yQuat=quatNorm({w:1,x:0,y:0,z:0}),totalQuat={w:1,x:0,y:0,z:0},cleanDensity=15,graphing=!1,points=[],pointQuats=[],ID=123,MQ,translation={x:0,y:0},translateConst=.001,onlyPlotNewPoints=!1,pointsToPlot=0,unitQuat={w:0,x:1,y:0,z:0},animationVars=[],animationImgs=[],cartGallery=[["","","5\\cos \\left(2\\sqrt{x^2+y^2}\\right)\\operatorname{sech}\\left(\\frac{\\sqrt{x^2+y^2}}{1.5}\\right)"],["","","\\cos x+\\cos y"],["\\sin \\left(\\tan \\left(\\frac{\\left(\\text{hypot}\\left(z,y\\right)\\right)}{5}\\right)\\right)","",""],["8\\operatorname{sech}\\left(\\frac{\\left(\\text{hypot}\\left(y,z\\right)\\right)}{4}\\right)-12\\operatorname{sech}\\left(\\frac{\\left(\\text{hypot}\\left(y-2,z-2\\right)\\right)}{2}\\right)","",""],["","\\sqrt{81-z^2-x^2}",""],["","","5\\frac{1}{1+e^y}+5\\frac{1}{1+e^x}-5"],["","","\\left(\\cos x+\\cos y\\right)\\left(\\frac{5}{1+\\sqrt{x^2+y^2}}\\sin \\left(\\sqrt{x^2+y^2}\\right)\\right)"]],cylinFuncGallery=[["\\sqrt{u^2+v^2}\\cos v","\\sin \\left(v\\right)+\\frac{\\cos \\left(5u\\right)}{5}","u"],["4\\operatorname{sech}z","",""],["\\frac{\\left(\\text{catalan}\\left(\\text{floor}\\left(\\text{abs}\\left(z\\right)+1\\right)\\right)\\right)}{5000}}{5000}","",""],["","\\rho +z",""],["","\\cos\\left(\\rho\\right)+\\sin\\left(z\\right)",""],["","3\\operatorname{sech}\\left(z\\right)\\left(\\cos \\left(\\rho\\right)+\\sin\\left(z\\right)\\right)",""],["","","\\phi "],["","","\\sin\\left(\\rho\\right)\\cos\\left(\\phi\\right)"],["5+2\\cos \\left(v\\right)","u","2\\sin\\left(v\\right)"]],sphereFuncGallery=[["5\\left(1+2\\cos \\left(\\phi \\right)\\right)","",""],["","r\\phi ",""],["","r-\\phi ",""],["","","\\frac{r\\theta }{4}"],["v","\\sin\\left(3u\\right)","\\frac{uv}{4}"],["2\\left(u-\\pi \\right)","\\sin \\left(2u\\right)","\\cos \\left(v\\right)"]],graphingError=!1,axes=[[{w:0,x:1,y:0,z:0},{w:0,x:-1,y:0,z:0},{w:0,x:1,y:0,z:0},{w:0,x:-1,y:0,z:0}],[{w:0,x:0,y:1,z:0},{w:0,x:0,y:-1,z:0},{w:0,x:0,y:1,z:0},{w:0,x:0,y:-1,z:0}],[{w:0,x:0,y:0,z:1},{w:0,x:0,y:0,z:-1},{w:0,x:0,y:0,z:1},{w:0,x:0,y:0,z:-1}]];$(function(){var a=$("#content-graph").width(),b=$("#content-graph").height();$("#canvas").prop("width",a),$("#canvas").prop("height",b),$("#u-v-range-row").hide(),$("#plot-table").editableTableWidget({cloneProperties:["background","border","outline","padding","text-align","font-size"],editor:$("<textarea>")});var c=function(a,b){for(var c=$(this).children($("td")),d=!0,e=0;e<c.length;e++)c[e].textContent.trim().length>0&&(d=!1);if(d){var f=$(this).next("tr"),g=$(a.target),h=$(this).children().index(g);$(this).remove(),f[0]&&f.children("td")[h].focus()}},d=function(a,b){$(this).off("validate"),b.trim().length>0&&$("#plot-table-body").append("<tr><td></td><td></td><td></td></tr>"),$("#plot-table").editableTableWidget({cloneProperties:["background","border","outline","padding","text-align","font-size"],editor:$("<textarea>")}),$("#plot-table tr:last").on("validate",arguments.callee),$("#plot-table tr:not(:last)").on("change",c)};$("#plot-table tr:last").on("validate",d),$("#plot-table tr:not(:last)").on("change",c),$("#plot-table td").on("validate",function(a,b){$(this).off("validate");var e=a.target,f=b.split("\n"),g=$(this).parent(),h=g.parent(),i=h.children("tr").index(g),j=g.children().index(e),k=!1;f.length>1&&(k=!0);for(var l=0;l<f.length;l++){var m=f[l].split("\t");if(m.length>1){k=!0;var n,o=!1;h.children("tr")[l+i]?n=$(h.children("tr")[l+i]):($("#plot-table-body").append("<tr><td></td><td></td><td></td></tr>"),n=$("#plot-table-body").children("tr").last(),o=!0);for(var p=n.children("td"),q=j;q<=2&&q-j<m.length;)p[q].textContent=m[q-j],q++}}k&&(e.textContent=f[0].split("\t")[0],$("#plot-table + textarea").val(e.textContent),$("#plot-table").editableTableWidget({cloneProperties:["background","border","outline","padding","text-align","font-size"],editor:$("<textarea>")}),$("#plot-table tr:last").on("validate",d),$("#plot-table tr:not(:last)").on("change",c),o&&d(a,b)),$("#plot-table td").on("validate",arguments.callee)}),$("#rho-phi-height-range-row").hide(),$("#cylindrical-coordinates").hide(),$("#r-theta-sphi-range-row").hide(),$("#spherical-coordinates").hide(),$("#help").click(function(){$("#help-popup").removeClass("hidden"),$(document).mouseup(function(a){var b=$("#help-content");b.is(a.target)||0!==b.has(a.target).length||($("#help-popup").addClass("hidden"),$("#help-content").unbind("click",document))})}),$("#help-popup").click(function(a){}),$("#export-button").click(function(){$("#export-popup").removeClass("hidden"),setUpDownload(),$(document).mouseup(function(a){var b=$("#export-content");b.is(a.target)||0!==b.has(a.target).length||($("#export-popup").addClass("hidden"),$("#export-content").unbind("click",document))})}),$("#export-cancel-button").click(function(){$("#export-popup").addClass("hidden"),$("#export-content").unbind("click",document)}),$("#export-save-button").click(function(){$("#export-popup").addClass("hidden"),$("#export-content").unbind("click",document)}),$("#export-popup").click(function(a){}),$("#animate-button").click(function(a){$("#animate-popup").removeClass("hidden"),$(document).mousedown(function(a){var b=$("#animate-content");b.is(a.target)||0!==b.has(a.target).length||($("#animate-popup").addClass("hidden"),$("#animate-content").unbind("click",document))})}),$("#animate-start-button").click(function(){animate()}),$("#add-variable-button").click(function(){var a=$(".variable-list-item").last().clone();a.find(".var-name-input").val(""),a.find(".var-lower-bound-input").val(""),a.find(".var-upper-bound-input").val(""),a.find(".variable-remove-button").click(function(a){$(".variable-list-item").length>1&&removeVariable(a.target)}),a.insertBefore($("#add-variable-button"))}),$(".variable-remove-button").click(function(a){$(".variable-list-item").length>1&&removeVariable(a.target)}),MQ=MathQuill.getInterface(2);for(var e=document.getElementById("x-input"),f=document.getElementById("y-input"),g=document.getElementById("z-input"),h=document.getElementById("rho-input"),i=document.getElementById("phi-input"),j=document.getElementById("height-input"),k=document.getElementById("sphi-input"),l=document.getElementById("r-input"),m=document.getElementById("theta-input"),n="pi theta rho phi sqrt sum",o=[e,f,g,i,j,h,k,m,l],p=0;p<o.length;p++)!function(){MQ.MathField(o[p],{spaceBehavesLikeTab:!0,sumStartsWithNEquals:!0,supSubsRequireOperand:!0,autoCommands:n,handlers:{enter:function(a){$("#graph-button").click()}}})}();var q=document.getElementById("x-range-min-input"),r=document.getElementById("y-range-min-input"),s=document.getElementById("z-range-min-input"),t=document.getElementById("x-range-max-input"),u=document.getElementById("y-range-max-input"),v=document.getElementById("z-range-max-input"),w=document.getElementById("rho-range-min-input"),x=document.getElementById("phi-range-min-input"),y=document.getElementById("height-range-min-input"),z=document.getElementById("rho-range-max-input"),A=document.getElementById("phi-range-max-input"),B=document.getElementById("height-range-max-input"),C=document.getElementById("r-range-min-input"),D=document.getElementById("theta-range-min-input"),E=document.getElementById("sphi-range-min-input"),F=document.getElementById("r-range-max-input"),G=document.getElementById("theta-range-max-input"),H=document.getElementById("sphi-range-max-input"),I=document.getElementById("u-range-min-input"),J=document.getElementById("u-range-max-input"),K=document.getElementById("v-range-min-input"),L=document.getElementById("v-range-max-input");n="pi sqrt";for(var M=[q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L],N=0;N<M.length;N++)!function(){MQ.MathField(M[N],{supSubsRequireOperand:!0,autoCommands:n})}();syncAxes(),randomGraph(),setTimeout(function(){for(var a=MQ.MathField(document.getElementById("x-input")),b=MQ.MathField(document.getElementById("y-input")),c=MQ.MathField(document.getElementById("z-input")),d=MQ.MathField(document.getElementById("rho-input")),e=MQ.MathField(document.getElementById("phi-input")),f=MQ.MathField(document.getElementById("height-input")),g=MQ.MathField(document.getElementById("r-input")),h=MQ.MathField(document.getElementById("theta-input")),i=MQ.MathField(document.getElementById("sphi-input")),j=[a,b,c,d,e,f,g,h,i],k=0;k<j.length;k++){var l=j[k];l.cmd(")"),l.keystroke("Backspace"),l.blur()}},500),domain.coloring=!0,document.getElementById("color-checkbox").checked=!0,totalQuat={w:.7946319801955918,x:.04116688544469564,y:-.5886375904216452,z:-.14272733002412488},graph();var O=!1,P=!1,Q={x:0,y:0};$("#canvas").mousemove(function(a){var b,c;if(!P&&O&&(b=a.clientX-Q.x,c=a.clientY-Q.y,xQuat.y=-b/500,yQuat.x=c/500,quatNorm(xQuat),quatNorm(yQuat),rotatePoints(pointQuats,yQuat),rotatePoints(pointQuats,xQuat),totalQuat=quatMult(quatMult(xQuat,yQuat),totalQuat),quatNorm(totalQuat),rotatePoints(axes[0],yQuat),rotatePoints(axes[1],yQuat),rotatePoints(axes[2],yQuat),rotatePoints(axes[0],xQuat),rotatePoints(axes[1],xQuat),rotatePoints(axes[2],xQuat),plotPoints()),P){domain.panCenter||(domain.panCenter={x:domain.center.x,y:domain.center.y,z:domain.center.z}),c=a.clientX-Q.x,b=a.clientY-Q.y;var d=pointToQuat({x:-1,y:0,z:0}),e=pointToQuat({x:0,y:-1,z:0});rotate(d,quatConj(totalQuat),{x:0,y:0,z:0}),rotate(e,quatConj(totalQuat),{x:0,y:0,z:0});var f=domain.x.max-domain.x.min,g=domain.y.max-domain.y.min,h=domain.z.max-domain.z.min;d.x*=f*translateConst,d.y*=g*translateConst,d.z*=h*translateConst,d=quatScalar(d,b),e.x*=f*translateConst,e.y*=g*translateConst,e.z*=h*translateConst,e=quatScalar(e,c),domain.center.x+=d.x+e.x,domain.center.y+=d.y+e.y,domain.center.z+=d.z+e.z,domain.x.min=domain.center.x-f/2,domain.x.max=domain.center.x+f/2,domain.y.min=domain.center.y-g/2,domain.y.max=domain.center.y+g/2,domain.z.min=domain.center.z-h/2,domain.z.max=domain.center.z+h/2,changeDomainInputs(),syncAxes(),syncQuats(),plotPoints()}Q={x:a.clientX,y:a.clientY}}),$("#canvas").mousedown(function(a){O=!1,P=!1,1===a.which?O=!0:3===a.which,Q={x:a.clientX,y:a.clientY},domain.coloring&&domain.coloringTime&&domain.coloringTime>100?(domain.wasColoring=!0,domain.coloring=!1):domain.wasColoring=!1}),$("#canvas").mouseup(function(a){O=!1,P&&(skipDomain=!0,graph(),skipDomain=!1,domain.panCenter=null),domain.wasColoring&&(domain.coloring=!0),plotPoints(),P=!1});var R;$("#canvas").bind("mousewheel",function(a){var b=1;b=a.originalEvent.wheelDelta>0?.9:1/.9;var c=getRealDomainCenter(),d=getRealDomainWidth(),f=c.x-d.x/2,g=c.x+d.x/2;domain.x.min=spreadCoord(f,f,g,b*domain.x.spread),domain.x.max=spreadCoord(g,f,g,b*domain.x.spread),f=c.y-d.y/2,g=c.y+d.y/2,domain.y.min=spreadCoord(f,f,g,b*domain.y.spread),domain.y.max=spreadCoord(g,f,g,b*domain.y.spread),f=c.z-d.z/2,g=c.z+d.z/2,domain.z.min=spreadCoord(f,f,g,b*domain.z.spread),domain.z.max=spreadCoord(g,f,g,b*domain.z.spread),cartesian||(spherical?(domain.r.min*=b,domain.r.max*=b):cylindrical&&(domain.rho.min*=b,domain.rho.max*=b,f=domain.height.min,g=domain.height.max,domain.height.min=spreadCoord(f,f,g,b),domain.height.max=spreadCoord(g,f,g,b))),syncAxes(),R&&clearTimeout(R),domain.coloringTime&&domain.coloringTime>100&&domain.coloring&&(domain.wasColoring=!0,domain.coloring=!1),plotPoints(),domain.wasColoring&&(domain.coloring=!0),R=setTimeout(function(){changeDomainInputs(),skipDomain=!0,graph(),skipDomain=!1},500)}),document.getElementById("canvas").oncontextmenu=function(a){return!1}}),$(window).resize(function(){var a=$("#content-graph").width(),b=$("#content-graph").height();domain.fullscreen?($("#canvas").prop("width",$(window).width()),$("#canvas").prop("height",$(window).height())):($("#canvas").prop("width",a),$("#canvas").prop("height",b)),plotPoints()});var cylindrical=!1,spherical=!1,cartesian=!0,skipDomain=!1,intervalId,intervalId2,intervalId3,intervalId4,intervalId5,intervalFunctionSupported=!0;$("#cartesian-button").click(function(){cartesian=!0,cylindrical=!1,spherical=!1,$("densisty"),$("#rho-phi-height-range-row").hide(),$("#r-theta-sphi-range-row").hide(),$("#spherical-coordinates").hide(),$("#cylindrical-coordinates").hide(),$("#cartesian-coordinates").show(),$("#x-y-z-range-row").show(),isParametric()?$("#u-v-range-row").show():$("#u-v-range-row").hide(),$("#x-plot-heading").html("\\(x\\)"),$("#y-plot-heading").html("\\(y\\)"),$("#z-plot-heading").html("\\(z\\)"),refreshMathJax(),domain.pointsOnly?($("#plot-row").show(),$("#cartesian-coordinates").hide(),$("#density-row").hide(),$("#u-v-range-row").hide(),$("#color-row").hide()):($("#plot-row").hide(),$("#color-row").show(),$("#density-row").show())}),$("#cylindrical-button").click(function(){cartesian=!1,cylindrical=!0,spherical=!1,$("#cartesian-coordinates").hide(),$("#x-y-z-range-row").hide(),$("#spherical-coordinates").hide(),$("#r-theta-sphi-range-row").hide(),$("#rho-phi-height-range-row").show(),$("#cylindrical-coordinates").show(),isCylindricalParametric()?$("#u-v-range-row").show():$("#u-v-range-row").hide(),$("#x-plot-heading").html("\\(\\rho\\)"),$("#y-plot-heading").html("\\(\\phi\\)"),$("#z-plot-heading").html("\\(z\\)"),refreshMathJax(),domain.pointsOnly?($("#plot-row").show(),$("#cylindrical-coordinates").hide(),$("#density-row").hide(),$("#u-v-range-row").hide(),$("#color-row").hide()):($("#plot-row").hide(),$("#color-row").show(),$("#density-row").show())}),$("#spherical-button").click(function(){cartesian=!1,cylindrical=!1,spherical=!0,$("#cartesian-coordinates").hide(),$("#x-y-z-range-row").hide(),$("#cylindrical-coordinates").hide(),$("#rho-phi-height-range-row").hide(),$("#r-theta-sphi-range-row").show(),$("#spherical-coordinates").show(),isSphericalParametric()?$("#u-v-range-row").show():$("#u-v-range-row").hide(),$("#x-plot-heading").html("\\(r\\)"),$("#y-plot-heading").html("\\(\\theta\\)"),$("#z-plot-heading").html("\\(\\phi\\)"),refreshMathJax(),domain.pointsOnly?($("#plot-row").show(),$("#spherical-coordinates").hide(),$("#density-row").hide(),$("#u-v-range-row").hide(),$("#color-row").hide()):($("#plot-row").hide(),$("#color-row").show(),$("#density-row").show())}),$("#plot-button").click(function(){domain.pointsOnly=!domain.pointsOnly,domain.pointsOnly?$("#plot-button").css("background-color","rgb(34, 149, 84)"):$("#plot-button").css("background-color",""),cartesian&&$("#cartesian-button").click(),cylindrical&&$("#cylindrical-button").click(),spherical&&$("#spherical-button").click()}),$("#axes-checkbox").change(function(){$("#axes-checkbox").prop("checked")===!0?domain.showAxes=!0:domain.showAxes=!1,plotPoints()}),$("#color-checkbox").change(function(){$("#color-checkbox").prop("checked")===!0?domain.coloring=!0:domain.coloring=!1,plotPoints()}),$("#mesh-checkbox").change(function(){domain.showMeshWhileColoring=$("#mesh-checkbox").prop("checked"),plotPoints()}),$("#directional-lighting-checkbox").change(function(){domain.directionalLighting=$("#directional-lighting-checkbox").prop("checked"),plotPoints()}),$("#perspective-checkbox").change(function(){domain.perspective=$("#perspective-checkbox").prop("checked"),plotPoints()}),$("#color-scheme-select").change(function(){var a=$(this).val();"dark-rust"==a&&(domain.backgroundColor="dark",domain.minHue=0,domain.maxHue=50),"light-rust"==a&&(domain.backgroundColor="light",domain.minHue=0,domain.maxHue=50),"light-cool"==a&&(domain.backgroundColor="light",domain.minHue=150,domain.maxHue=300),"dark-cool"==a&&(domain.backgroundColor="dark",domain.minHue=150,domain.maxHue=300),"dark-blue"==a&&(domain.backgroundColor="dark",domain.minHue=50,domain.maxHue=170),"light-blue"==a&&(domain.backgroundColor="light",domain.minHue=50,domain.maxHue=170),plotPoints()}),$("#full-screen-button").click(function(){function b(){(document.webkitIsFullScreen||document.mozFullScreen||null!==document.msFullscreenElement)&&(domain.fullscreen=!1)}var a=document.getElementById("canvas");a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen(),domain.fullscreen=!0,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",b,!1),document.addEventListener("mozfullscreenchange",b,!1),document.addEventListener("fullscreenchange",b,!1),document.addEventListener("MSFullscreenChange",b,!1))}),$("#graph-button").click(function(){graph()});